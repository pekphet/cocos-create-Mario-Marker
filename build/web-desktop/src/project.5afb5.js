window.__require=function t(e,i,o){function r(a,s){if(!i[a]){if(!e[a]){var c=a.split("/");if(c=c[c.length-1],!e[c]){var u="function"==typeof __require&&__require;if(!s&&u)return u(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var p=i[a]={exports:{}};e[a][0].call(p.exports,function(t){return r(e[a][1][t]||t)},p,p.exports,t,e,i,o)}return i[a].exports}for(var n="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({Body:[function(t,e,i){"use strict";cc._RF.push(e,"3dd81UMsjNDKrM8VQROzk5m","Body");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./World"),a=cc._decorator,s=a.ccclass,c=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e=r([s],e)}(n.Body));i.default=c,cc._RF.pop()},{"./World":"World"}],MainPlayer:[function(t,e,i){"use strict";cc._RF.push(e,"b2ff8gOHZpCPoE0Dkd2bNTN","MainPlayer");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./World"),a=t("./lib/util"),s=cc._decorator,c=s.ccclass,u=s.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bgm=null,e.dieAudio=null,e.winAudio=null,e.jumpAudio=null,e.goldAudio=null,e.brokeAudio=null,e.monsterDieAudio=null,e.levelUpAudio=null,e.levelDownAudio=null,e.supreManModelAudio=null,e.jumpSpeedY=1e3,e.defaultSpeedX=400,e.type="MainPlayer",e.lastStatus={left:!1,right:!1,up:!1,isInAir:!0},e.lastPosition={x:0,y:0},e.frameCountAnimeFrames=0,e.frameCountAnime=[],e}return o(e,t),e.prototype.onLoad=function(){window.pl=this,h(),this.initBody();var t=a.getComponentInParents(this,n.default);null!=t&&t.setMainPlayer(this),a.playBgm(this.bgm)},e.prototype.jump=function(){this.frameCountAnime.length>0||this.isDie||this.jumpCount>0&&(this.jumpCount--,this.speedY=this.jumpSpeedY,a.playAudio(this.jumpAudio))},e.prototype.die=function(){return!this.isDie},e.prototype.updateKeyStaus=function(){a.globalData.keyStatus.left&&(this.speedX=-this.defaultSpeedX),a.globalData.keyStatus.right&&(this.speedX=this.defaultSpeedX),0==a.globalData.keyStatus.left&&0==a.globalData.keyStatus.right&&(this.speedX=0),a.globalData.keyStatus.up&&0==this.lastStatus.up&&this.jump(),this.speedY<-this.jumpSpeedY&&(this.speedY=-this.jumpSpeedY),Object.assign(this.lastStatus,a.globalData.keyStatus)},e.prototype.updateRectObjs=function(){var t=this,e=this.world.getRectObjs(this);e.contactCells.forEach(function(e){"\u7816\u5757"==e.type?t.y+t.body.y+t.body.height/2==e.y*n.gridSize&&(t.world.clearMapAt(e.x,e.y),a.playAudio(t.brokeAudio)):"\u95ee\u53f7"==e.type&&t.y+t.body.y+t.body.height/2==e.y*n.gridSize&&(t.world.setMapAt(e.x,e.y,"\u95ee\u53f72"),a.playAudio(t.brokeAudio))}),0==this.isDie&&e.rectBodys.some(function(e){e.type==n.Body.types.Hurt&&t.die()}),0==this.isDie&&e.rectPlayers.some(function(e){t.rectPlayer(e)}),this.lastPosition={x:this.x,y:this.y}},e.prototype.rectPlayer=function(t){switch(t.type){case"Monster":this.speedY<0&&this.lastPosition.y>t.y+t.body.height?(a.playAudio(this.monsterDieAudio),this.speedY=600,this.jumpCount=this.jumpCountMax-1,t.die()):this.die()}},e.prototype.updateStatus=function(){this.isDie},e.prototype.setFrameCountAnime=function(t){var e={frameIndex:0};t.forEach(function(t){t.frameIndex||(t.frameIndex=e.frameIndex+(t.framePlus||0)),e=t}),this.frameCountAnime=t},e.prototype.runFrameCountAnime=function(){if(this.frameCountAnimeFrames++,this.frameCountAnimeFrames>=this.frameCountAnime[0].frameIndex){var t=this.frameCountAnime.shift().callback;t&&t(),0==this.frameCountAnime.length&&(this.frameCountAnimeFrames=0)}},e.prototype.worldUpdate=function(){this.frameCountAnime.length>0?this.runFrameCountAnime():this.isDie||(this.updateKeyStaus(),this.updateRectObjs(),this.updateStatus())},r([u({type:cc.AudioClip})],e.prototype,"bgm",void 0),r([u({type:cc.AudioClip})],e.prototype,"dieAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"winAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"jumpAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"goldAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"brokeAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"monsterDieAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"levelUpAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"levelDownAudio",void 0),r([u({type:cc.AudioClip})],e.prototype,"supreManModelAudio",void 0),r([u({displayName:"\u8df3\u7684\u901f\u5ea6"})],e.prototype,"jumpSpeedY",void 0),r([u({displayName:"\u79fb\u52a8\u901f\u5ea6"})],e.prototype,"defaultSpeedX",void 0),e=r([c],e)}(n.Player);function h(){h.isRun||(h.isRun=!0,cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(t){82!=t.keyCode&&116!=t.keyCode||location.reload(),37==t.keyCode&&(a.globalData.keyStatus.left=!0),39==t.keyCode&&(a.globalData.keyStatus.right=!0),38==t.keyCode&&(a.globalData.keyStatus.up=!0)}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,function(t){37==t.keyCode&&(a.globalData.keyStatus.left=!1),39==t.keyCode&&(a.globalData.keyStatus.right=!1),38==t.keyCode&&(a.globalData.keyStatus.up=!1)}))}i.default=p,h.isRun=!1,cc._RF.pop()},{"./World":"World","./lib/util":"util"}],Props:[function(t,e,i){"use strict";cc._RF.push(e,"81e02Ic7RdAUreCXM4KTmi7","Props");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./World"),a=cc._decorator,s=a.ccclass,c=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isFlyPlayer=!0,e.type="PropsComponent",e}return o(e,t),e=r([s],e)}(n.Player));i.default=c,cc._RF.pop()},{"./World":"World"}],SpriteMap:[function(t,e,i){"use strict";cc._RF.push(e,"9d833CUrNJFr71PB9/l4OJd","SpriteMap");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./World"),a=t("./lib/util"),s=cc._decorator,c=s.ccclass,u=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onLoad=function(){this.initBody(),this.initWorld()},e.prototype.initWorld=function(){var t=a.getComponentInParents(this,n.default);null!=t&&t.addSpriteMap(this)},e.prototype.initBody=function(){var t=this,e=this.getComponentsInChildren(n.Body);if(e.length>0)e.forEach(function(e){return[e.target=t]}),this.bodys=e;else{var i=(new n.Body).init(this.node.width,this.node.height);i.target=this,this.bodys=[i]}},e=r([c],e)}(n.BaseSpriteMap));i.default=u,cc._RF.pop()},{"./World":"World","./lib/util":"util"}],TiledMap:[function(t,e,i){"use strict";cc._RF.push(e,"27830zbN5lHdIAAqKVYZ+S6","TiledMap");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./World"),a=t("./lib/util"),s=cc._decorator,c=s.ccclass,u=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.onLoad=function(){a.getComponentInParents(this,n.default).setTiledMap(this.getComponent(cc.TiledMap))},e=r([c],e)}(cc.Component));i.default=u,cc._RF.pop()},{"./World":"World","./lib/util":"util"}],World:[function(t,e,i){"use strict";cc._RF.push(e,"ad510D2N09IhJn2kc2Zdc+V","World");var o=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),r=this&&this.__decorate||function(t,e,i,o){var r,n=arguments.length,a=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,o);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(n<3?r(a):n>3?r(e,i,a):r(e,i))||a);return n>3&&a&&Object.defineProperty(e,i,a),a};Object.defineProperty(i,"__esModule",{value:!0});var n=t("./lib/util"),a=cc._decorator,s=a.ccclass,c=a.property;i.frameTime=1/60,i.gridSize=16;var u={33:"\u95ee\u53f7",36:"\u95ee\u53f72",37:"\u7816\u5757",65:"\u5730\u677f",66:"\u786c\u7816\u5757"},p=function(){var t={};for(var e in u)t[u[e]]=e;return t}(),h=function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i.type=e.types.Entity,i.active=!0,i.x=0,i.y=0,i.height=0,i.width=0,i.target=null,i}return o(e,t),e.prototype.init=function(t,e,i,o){return void 0===i&&(i=0),void 0===o&&(o=0),this.x=i,this.y=o,this.height=e,this.width=t,this},e.prototype.onLoad=function(){this.node&&(this.node.removeComponent(cc.Sprite),this.x=this.node.x,this.y=this.node.y,this.height=this.node.height,this.width=this.node.width)},e.types=cc.Enum({Entity:0,Hurt:1,Smart:2,Player:3}),r([c({type:e.types,tooltip:"\u5224\u5b9a\u6846\u7c7b\u578b\nEntity : \u5b9e\u4f53\nHurt : \u4f24\u5bb3\nSmart : \u667a\u80fd\nPlayer : \u73a9\u5bb6\u7528"})],e.prototype,"type",void 0),e}(cc.Component);i.Body=h;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.body=null,e.isInAir=!0,e.isFlyPlayer=!1,e.isDie=!1,e.jumpCount=0,e.jumpCountMax=2,e.speedX=0,e.speedY=0,e.world=null,e.type="",e.linkDecisionBox=null,e.actions=null,e}return o(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.node.x},set:function(t){this.node.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.node.y},set:function(t){this.node.y=t},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){this.initBody()},e.prototype.onEnterCamera=function(){},e.prototype.onLeaveCamera=function(){},e.prototype.onBeHit=function(t){},e.prototype.die=function(){return!this.isDie&&(this.isDie=!0,this.body.active=!1,!0)},e.prototype.worldUpdate=function(){},e.prototype.initBody=function(){var t=this.getComponentInChildren(h);this.body=null!=t?t:(new h).init(this.node.width,this.node.height)},e}(cc.Component);i.Player=l;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="Props",e.isFlyPlayer=!0,e}return o(e,t),e.prototype.die=function(){return!!t.prototype.die.call(this)&&(this.world.removePlayer(this),!0)},e}(l);i.Props=d;var y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bodys=[],e}return o(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.node.x},set:function(t){this.node.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.node.y},set:function(t){this.node.y=t},enumerable:!0,configurable:!0}),e}(cc.Component);i.BaseSpriteMap=y;var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.gravityY=-1600,e.gravityX=0,e.useDebugLayer=!0,e.tiledMapComponent=null,e.tiledMapLayer=null,e.map=[],e.mapSize={height:0,width:0},e.mainPlayer=null,e.players=[],e.spriteMaps=[],e.camera=null,e.inCameraPlayers=[],e.paused=!1,e.pausedFocusPlayer=null,e}return o(e,t),e.prototype.onLoad=function(){this.initCamera(),window.world=this},e.prototype.pause=function(t){this.pausedFocusPlayer=t,this.paused=!0},e.prototype.play=function(){this.pausedFocusPlayer=null,this.paused=!1},e.prototype.setTiledMap=function(t){this.tiledMapComponent=t,this.tiledMapLayer=this.tiledMapComponent.getLayer("default");var e=this.tiledMapLayer.getLayerSize().width;this.map=n.splitByLength(this.tiledMapLayer._tiles,e).reverse(),this.mapSize={height:this.map.length,width:this.map[0].length}},e.prototype.setMainPlayer=function(t){this.mainPlayer=t,this.addPlayer(this.mainPlayer),this.camera.setMainPlayer(t)},e.prototype.initCamera=function(){this.camera=new g(this.node.width,this.node.height),this.camera.setWorld(this),this.camera.setMainPlayer(this.mainPlayer),this.camera.setArea(.1,.4,.3,.3)},e.prototype.addPlayer=function(t){t.world=this,this.players.push(t),this.mainPlayer},e.prototype.addSpriteMap=function(t){this.spriteMaps.push(t)},e.prototype.removePlayer=function(t){n.removeItem(this.players,t),t.node.destroy(),t.destroy()},e.prototype.getMapAt=function(t,e){return this.map[e][t]},e.prototype.setMapAt=function(t,e,i){"string"==typeof i?(this.map[e][t]=p[i],this.tiledMapLayer.setTileGIDAt(p[i],t,this.mapSize.height-e-1)):(this.map[e][t]=i,this.tiledMapLayer.setTileGIDAt(i,t,this.mapSize.height-e-1))},e.prototype.clearMapAt=function(t,e){this.setMapAt(t,e,0)},e.prototype.update=function(){this.paused?this.pausedFocusPlayer&&(this.pausedFocusPlayer.isFlyPlayer?(this.pausedFocusPlayer.x+=this.pausedFocusPlayer.speedX*i.frameTime,this.pausedFocusPlayer.y+=this.pausedFocusPlayer.speedY*i.frameTime):(this.pausedFocusPlayer.isInAir=!0,this.updateMapCollision(this.pausedFocusPlayer))):this.worldUpdate(this.players),this.useDebugLayer&&this.updateDebugLayer()},e.prototype.updateDebugLayer=function(){var t=n.getNodeInCanvas("DebugLayer");null==t&&(t=new cc.Node("DebugLayer"),this.node.addChild(t)),t.children.forEach(function(t){return t.destroy()}),this.players.forEach(function(e){var i=n.createLayerColor();t.addChild(i),i.color=cc.color(0,0,255),i.anchorX=0,i.anchorY=0,i.opacity=125,i.height=e.body.height,i.width=e.body.width,i.x=e.x+e.body.x-e.body.width/2,i.y=e.y+e.body.y-e.body.height/2}),this.spriteMaps.forEach(function(e){e.bodys.forEach(function(i){var o=n.createLayerColor();switch(t.addChild(o),i.type){case h.types.Entity:o.color=cc.color(0,255,0);break;case h.types.Hurt:o.color=cc.color(255,0,0);break;case h.types.Smart:o.color=cc.color(255,255,0);break;case h.types.Player:o.color=cc.color(0,0,255)}o.anchorX=0,o.anchorY=0,o.opacity=125,o.height=i.height,o.width=i.width,o.x=e.x+i.x-i.width/2,o.y=e.y+i.y-i.height/2})})},e.prototype.worldUpdate=function(t){var e=this;t.forEach(function(t){t.isFlyPlayer?(t.x+=t.speedX*i.frameTime,t.y+=t.speedY*i.frameTime):(t.isInAir=!0,e.updateMapCollision(t))}),this.camera.worldUpdate();var o=this.camera.getInCameraPlayers();this.inCameraPlayers=this.inCameraPlayers.filter(function(t){return-1!=o.indexOf(t)||(t.onLeaveCamera(),!1)}),o.forEach(function(t){-1==e.inCameraPlayers.indexOf(t)&&(e.inCameraPlayers.push(t),t.onEnterCamera())}),t.forEach(function(t){t.worldUpdate()})},e.prototype.updateMapCollision_checkX=function(t,e,o,r,n){e+=t.speedX*i.frameTime;var a=this.getRectBodys(e,o,r,n).rectBodys.filter(function(t){return t.type==h.types.Entity});if(a.length>0){var s=a[0];return e=t.speedX>0?s.target.x+s.x-s.width/2-t.body.width:s.target.x+s.x+s.width/2,t.speedX=0,e}var c=this.getRectCells(this.map,e,o,r,n).find(function(t){return""!=t.type});return null!=c&&(e=t.speedX>=0?c.x*i.gridSize-r:c.x*i.gridSize+i.gridSize,t.speedX=0),e},e.prototype.updateMapCollision_checkY=function(t,e,o,r,n){var a=o;o+=t.speedY*i.frameTime;var s=this.getRectBodys(e,o,r,n).rectBodys,c=s.filter(function(t){return t.type==h.types.Smart}),u=s.filter(function(t){return t.type==h.types.Entity});if(u.length>0){var p=u[0];return t.speedY>=0?o=p.target.y+p.y-p.height/2-n:(t.isInAir=!1,t.jumpCount=t.jumpCountMax,o=p.target.y+p.y+p.height/2),t.speedY=0,o}if(c.length>0&&(p=c.sort(function(t,e){return e.target.y+e.y+e.height/2-(t.target.y+t.y+t.height/2)}).find(function(t){return a>=t.target.y+t.y+t.height/2})))return t.speedY<0&&(t.isInAir=!1,t.jumpCount=t.jumpCountMax,o=p.target.y+p.y+p.height/2),t.speedY=0,o;var l=this.getRectCells(this.map,e,o,r,n).find(function(t){return""!=t.type});return l&&(t.speedY>=0?o=l.y*i.gridSize-n:(t.isInAir=!1,t.jumpCount=t.jumpCountMax,o=l.y*i.gridSize+i.gridSize),t.speedY=0),o},e.prototype.updateMapCollision=function(t){t.speedY+=this.gravityY*i.frameTime,t.speedX+=this.gravityX*i.frameTime;var e=t.x+t.body.x-t.body.width/2,o=t.y+t.body.y-t.body.height/2;e=this.updateMapCollision_checkX(t,e,o,t.body.width,t.body.height),o=this.updateMapCollision_checkY(t,e,o,t.body.width,t.body.height),t.x=e-t.body.x+t.body.width/2,t.y=o-t.body.y+t.body.height/2},e.prototype.getRectObjs=function(t){var e=t.x+t.body.x-t.body.width/2,i=t.y+t.body.y-t.body.height/2,o=t.body.height,r=t.body.width,n=this.getRectCells(this.map,e,i,r,o),a=this.getContactCells(this.map,e,i,r,o,n),s=this.getRectBodys(e,i,r,o),c=s.rectBodys,u=s.contactBodys,p=this.getRectPlayers(t,e,i,r,o),h=p.contactPlayers;return{rectCells:n,contactCells:a,rectPlayers:p.rectPlayers,contactPlayers:h,rectBodys:c,contactBodys:u}},e.prototype.getRectBodys=function(t,e,i,o){var r=[],n=[];return this.spriteMaps.forEach(function(a){a.bodys.forEach(function(s){var c=a.x+s.x-s.width/2,u=a.y+s.y-s.height/2,p=c+s.width,h=u+s.height,l=m(t,e,t+i,e+o,c,u,p,h);l&&(l.inRect?r.push(s):n.push(s))})}),{rectBodys:r,contactBodys:n}},e.prototype.getRectPlayers=function(t,e,i,o,r){var n=[],a=[];return this.players.forEach(function(s){if(s!=t&&0!=s.body.active){var c=s.x+s.body.x-s.body.width/2,u=s.y+s.body.y-s.body.height/2,p=c+s.body.width,h=u+s.body.height,l=m(e,i,e+o,i+r,c,u,p,h);l&&(l.inRect?n.push(s):a.push(s))}}),{rectPlayers:n,contactPlayers:a}},e.prototype.getContactCells=function(t,e,o,r,n,a){e/=i.gridSize,o/=i.gridSize,r/=i.gridSize,n/=i.gridSize;var s=[],c=Math.floor(e),p=Math.ceil(e+r),h=Math.floor(o),l=Math.ceil(o+n);c==e&&c--,p==e+r&&p++,h==o&&h--,l==o+n&&l++;for(o=h;o<l;o++)for(e=c;e<p;e++)if(t[o]&&t[o][e]&&0!=t[o][e]){if(a.some(function(t){return t.x==e&&t.y==o}))continue;s.push({x:e,y:o,type:u[t[o][e]]||""})}return s},e.prototype.getRectCells=function(t,e,o,r,n){e/=i.gridSize,o/=i.gridSize,r/=i.gridSize,n/=i.gridSize;var a=[],s=Math.floor(e),c=Math.ceil(e+r),p=Math.floor(o),h=Math.ceil(o+n);for(o=p;o<h;o++)for(e=s;e<c;e++)t[o]&&t[o][e]&&0!=t[o][e]&&a.push({x:e,y:o,type:u[t[o][e]]||""});return a},r([c()],e.prototype,"gravityY",void 0),r([c()],e.prototype,"gravityX",void 0),r([c()],e.prototype,"useDebugLayer",void 0),e=r([s],e)}(cc.Component);i.default=f;var g=function(){function t(t,e,i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.width=0,this.height=0,this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.world=null,this.debugLayer=null,this.player=null,this.isShowDebugLayer=!1,this.focusingArea={x:0,y:0,width:0,height:0},this.width=t,this.height=e,this.x=i,this.y=o,this.focusingArea.width=.1*t,this.focusingArea.height=.2*e,this.focusingArea.x=.4*t,this.focusingArea.y=.4*e}return t.prototype.setMainPlayer=function(t){this.player=t,this.worldUpdate()},t.prototype.setArea=function(t,e,i,o){var r=this.width,n=this.height;this.focusingArea.width=r*t,this.focusingArea.height=n*e,this.focusingArea.x=r*i,this.focusingArea.y=n*o,this.isShowDebugLayer&&(this.debugLayer.height=this.focusingArea.height,this.debugLayer.width=this.focusingArea.width,this.debugLayer.x=this.focusingArea.x-cc.Canvas.instance.node.width/2+this.debugLayer.width/2,this.debugLayer.y=this.focusingArea.y-cc.Canvas.instance.node.height/2+this.debugLayer.height/2)},t.prototype.setWorld=function(t){this.world=t,this.offsetX=this.world.node.x,this.offsetY=this.world.node.y},t.prototype.initDebugLayer=function(){if(!this.isShowDebugLayer){this.isShowDebugLayer=!0;var t=n.createLayerColor();this.debugLayer=t,cc.Canvas.instance.node.addChild(t),t.color=cc.color(255,0,0),t.opacity=60,t.height=this.focusingArea.height,t.width=this.focusingArea.width,t.x=this.focusingArea.x-cc.Canvas.instance.node.width/2+t.width/2,t.y=this.focusingArea.y-cc.Canvas.instance.node.height/2+t.height/2}},t.prototype.getInCameraPlayers=function(){return this.world.getRectPlayers(null,-this.x,-this.y,this.width,this.height).rectPlayers},t.prototype.getAwayForCamera=function(t){return Math.sqrt(Math.pow(t.x+t.body.x-(this.x+this.width/2),2)+Math.pow(t.y+t.body.y-(this.y+this.height/2),2))},t.prototype.worldUpdate=function(){if(this.player){var t=this.player,e=t.x,i=t.y,o=this.focusingArea,r=o.x,n=o.y,a=o.width,s=o.height;e>-this.x+r+a?this.x=-e+r+a:e<-this.x+r&&(this.x=-e+r),i>-this.y+n+s?this.y=-i+n+s:i<-this.y+n&&(this.y=-i+n),this.x>0&&(this.x=0),this.y>0&&(this.y=0),this.world.node.setPosition(this.x+this.offsetX,this.y+this.offsetY)}},t}();function m(t,e,i,o,r,n,a,s){var c=[Math.max(t,r),Math.max(e,n),Math.min(i,a),Math.min(o,s)];if(c[0]>c[2]||c[1]>c[3])return null;var u={x:c[0],y:c[1],width:c[2]-c[0],height:c[3]-c[1]};return 0==u.width&&0==u.height?null:0!=u.width&&0!=u.height?{rect:u,inRect:!0}:{rect:u,inRect:!1}}i.rectInRect=m,cc._RF.pop()},{"./lib/util":"util"}],util:[function(t,e,i){"use strict";cc._RF.push(e,"3e09fUpOsNDDJsk+Bk3hpAe","util"),Object.defineProperty(i,"__esModule",{value:!0});var o={},r={},n={scale:1,events:[]};function a(t){a.isFirstRun&&(a.isFirstRun=!1,cc.view.setResizeCallback(function(){n.events.forEach(function(t){t()})})),n.events.push(t)}function s(t,e){var i=t.indexOf(e);return-1!=i&&(t.splice(i,1),!0)}function c(){var t=new cc.Node("debugLayer"),e=t.addComponent(cc.Sprite);return null==c.spriteFrame&&(c.spriteFrame=c.createSpriteFrame()),e.spriteFrame=c.spriteFrame,t}function u(t,e){if(t instanceof cc.Node){for(var i=0;i<t.children.length;i++){if(t.children[i].name==e)return t.children[i];var o=u(t.children[i],e);if(null!=o)return o}return null}return t instanceof cc.Component?u(t.node,e):null}i.setResizeCallback=a,a.isFirstRun=!0,i.clearResizeCallback=function(t){s(n.events,t)},i.globalData={freeController:!1,isRestart:!1,restartCount:0,scale:1,isShow:!0,keyStatus:{left:!1,right:!1,up:!1}},i.cloneJsonData=function(t){return JSON.parse(JSON.stringify(t))},i.removeItem=s,i.toGrid=function(t,e){for(var i=[],o=0;o<t.length;o+=e)i.push(t.slice(o,o+e));return i},i.angleToPosttion=function(t){var e=Math.sin(t*(Math.PI/180)),i=Math.cos(t*(Math.PI/180));return 0!=t&&180!=t||(e=0),90!=t&&270!=t||(i=0),{x:e,y:i}},i.getNodePositionDiff=function(t,e){var i=t.getNodeToWorldTransformAR(),o=i.tx,r=i.ty,n=e.getNodeToWorldTransformAR(),a=n.tx,s=n.ty;return cc.v2(a-o,s-r)},i.createLayerColor=c,c.spriteFrame=null,c.createSpriteFrame=function(){var t=new cc.Texture2D,e=new cc.SpriteFrame;return t.initWithData(new Uint8Array([255,255,255,255]),cc.Texture2D.PixelFormat.RGBA8888,1,1),e.setTexture(t),e},i.playAudio=function(t){t in r&&r[t]+33>Date.now()||(r[t]=Date.now(),o[t]=cc.audioEngine.play(t,!1,1))},i.playBgm=function(t){o[t]||(o[t]=cc.audioEngine.play(t,!0,1))},i.resumeAudio=function(t){cc.audioEngine.resume(o[t])},i.pauseAudio=function(t){cc.audioEngine.pause(o[t])},i.stopAudio=function(t){cc.audioEngine.stop(o[t]),o[t]=null},i.randomIntAtoB=function(t,e){return Math.round(t+(Math.random()*e-t))},i.getRandomItem=function(t){return t[Math.floor(Math.random()*t.length)]},i.getUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=t[0]||[],o=t.slice(1),r=new Set(i);return o.forEach(function(t){t.forEach(function(t){return r.add(t)})}),Array.from(r)},i.splitByLength=function(t,e){for(var i=[],o=0;o<t.length;o+=e)i.push(t.slice(o,o+e).slice());return i},i.getNodeInChildren=u,i.getNodeInCanvas=function(t){return u(cc.Canvas.instance.node,t)},i.getComponentInParents=function t(e,i){if(e instanceof cc.Node)for(var o=e;null!=o;){var r=o.getComponent(i);if(null!=r)return r;o=o.parent}return e instanceof cc.Component?t(e.node,i):null},cc._RF.pop()},{}]},{},["Body","MainPlayer","Props","SpriteMap","TiledMap","World","util"]);